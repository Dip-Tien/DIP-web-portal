@using System.Globalization
@using MyWebERP.Model
@using MyWebERP.Lib

@inject Microsoft.Extensions.Localization.IStringLocalizer Language


<div class="mb-2">
    <input type="text" class="form-control form-control-sm"
           placeholder="@Language["Tìm kiếm..."]"
           @bind="searchText" />
</div>

<div class="row row-cols-1 g-2">
    @foreach (var item in FilteredData)
    {
        <div class="col">
            <div class="card shadow-sm rounded-3">
                <div class="card-body p-2">

                    <!-- Mã + Tên -->
                    <h6 class="card-title mb-1">
                        <i class="bi bi-person-circle me-1"></i>@item.customer_name
                    </h6>
                    <div class="small text-muted mb-1">
                        <i class="bi bi-upc me-1"></i>@item.customer_code
                    </div>

                    <!-- Địa chỉ -->
                    <div class="small mb-1">
                        <i class="bi bi-geo-alt text-danger me-1"></i>
                        @item.full_address
                    </div>

                    <!-- Liên hệ -->
                    <div class="small mb-1">
                        <i class="bi bi-telephone me-1"></i>@item.tel
                        <i class="bi bi-envelope ms-2 me-1"></i>@item.email
                    </div>

                    <!-- Xưng hô + Giới tính -->
                    <div class="small mb-1">
                        <i class="bi bi-person-circle me-1"></i>@item.vocative
                        @if (!string.IsNullOrWhiteSpace(item.gender))
                        {
                            if (item.gender == "Nam" || item.gender == "Male")
                            {
                                <span class="ms-2"><i class="bi bi-gender-male text-primary me-1"></i>@Language["Nam"]</span>
                            }
                            else if (item.gender == "Nữ" || item.gender == "Female")
                            {
                                <span class="ms-2"><i class="bi bi-gender-female text-danger me-1"></i>@Language["Nữ"]</span>
                            }
                            else
                            {
                                <span class="ms-2"><i class="bi bi-gender-ambiguous me-1"></i>@Language["Khác"]</span>
                            }
                        }
                    </div>

                    <!-- Cá nhân / Tổ chức -->
                    <div class="small mb-1">
                        @if (item.is_personal==1)
                        {
                            <i class="bi bi-person-check text-success me-1"></i>
                            @Language["Cá nhân"]
                        }
                        else
                        {
                            <i class="bi bi-buildings text-info me-1"></i>
                            @Language["Tổ chức"]
                        }
                    </div>

                    <!-- Nhóm khách -->
                    <div class="small mb-1">
                        <i class="bi bi-people me-1"></i>FilteredDataitem.cust_category_name
                    </div>

                    <!-- Ghi chú -->
                    <div class="small mb-1">
                        <i class="bi bi-journal-text me-1"></i>@item.comment
                    </div>

                    <!-- Trạng thái -->
                    <div class="small mb-1">
                        @if (item.inactive==1)
                        {
                            <span class="text-danger"><i class="bi bi-slash-circle me-1"></i>@Language["Không SD"]</span>
                        }
                        else
                        {
                            <span class="text-success"><i class="bi bi-check-circle me-1"></i>@Language["Đang SD"]</span>
                        }
                    </div>

                    <!-- Người tạo -->
                    @* <div class="small mb-1">
                        <i class="bi bi-person-badge me-1"></i>@DisplayOrEmpty(item.created_by_display_name)
                        <span class="ms-2"><i class="bi bi-calendar3 me-1"></i>@DisplayOrEmpty(item.created_on_date)</span>
                    </div> *@

                    <!-- Người sửa -->
                    @* <div class="small">
                        <i class="bi bi-person-fill-gear me-1"></i>@DisplayOrEmpty(item.last_modified_by_display_name)
                        <span class="ms-2"><i class="bi bi-calendar-event me-1"></i>@DisplayOrEmpty(item.last_modified_on_date)</span>
                    </div> *@

                </div>
            </div>
        </div>
    }
</div>

@code {
    [Parameter] public IEnumerable<CustomerModel>? Data { get; set; }

    private string searchText = "";

    private IEnumerable<CustomerModel> FilteredData =>
        string.IsNullOrWhiteSpace(searchText) || Data == null
        ? Data ?? Enumerable.Empty<CustomerModel>()
        : Data.Where(item =>
            CM.ContainsIgnoreDiacritics(item.customer_name, searchText) ||
            CM.ContainsIgnoreDiacritics(item.customer_code, searchText) ||
            CM.ContainsIgnoreDiacritics(item.full_address, searchText) ||
            CM.ContainsIgnoreDiacritics(item.tel, searchText) ||
            CM.ContainsIgnoreDiacritics(item.email, searchText) ||
            CM.ContainsIgnoreDiacritics(item.vocative, searchText) ||
            CM.ContainsIgnoreDiacritics(item.cust_category_name, searchText) ||
            CM.ContainsIgnoreDiacritics(item.comment, searchText) ||
            CM.ContainsIgnoreDiacritics(item.created_by_display_name, searchText) ||
            CM.ContainsIgnoreDiacritics(item.last_modified_by_display_name, searchText)
        );

    // private string DisplayOrEmpty(string? value) =>
    //     string.IsNullOrWhiteSpace(value) ? Language["Chưa cập nhật"] : value!;
}
